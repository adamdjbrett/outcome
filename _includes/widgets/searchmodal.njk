<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h1 class="modal-title fs-5" id="searchModalLabel">{{metadata.search.title}} <i class="fa-solid fa-magnifying-glass"></i></h1>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body p-3 p-md-3 bg-light rounded opacity-95">
<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<div id="search"></div>
<script>
    // Only initialize Pagefind UI when the modal is shown
    let pagefindInstance = null;
    document.addEventListener('shown.bs.modal', function(event) {
        if (event.target && event.target.id === 'searchModal') {
            // Remove previous instance if any
            const searchDiv = document.getElementById('search');
            if (searchDiv) searchDiv.innerHTML = '';
            pagefindInstance = new PagefindUI({ element: "#search", showSubResults: true });
            // Focus the input after rendering
            setTimeout(() => {
                const input = document.querySelector('#search input');
                if (input) input.focus();
            }, 100);
        }
    });
</script>
</div>
</div>
</div>
</div>
